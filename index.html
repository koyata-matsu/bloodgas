<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>血液ガス判定クイズ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="wrap">
    <header class="head">
      <h1>血液ガス判定クイズ</h1>
      <div class="meta"><span id="modeLabel">Menu</span></div>
    </header>

    <!-- MENU: 5ステージ -->
    <section class="card screen" id="screenMenu">
      <h2>ステージを選ぶ</h2>
      <p class="muted">ステージをクリアして次を解放しよう。</p>

      <div class="difficulty" id="stageList">
        <button class="choice big stageBtn" data-stage="1">
          <span class="stageRow">
            <span class="stageTitle"><span class="stageEmoji">🩸</span>ステージ0：正常値の判断</span>
            <span class="stageTag live">いま挑戦</span>
          </span>
          <span class="sub">高値・正常値・低値を即答</span>
        </button>

        <button class="choice big stageBtn" data-stage="2">
          <span class="stageRow">
            <span class="stageTitle"><span class="stageEmoji">🧠</span>ステージ1：酸塩基の4分類</span>
          </span>
          <span class="sub">pHとPaCO₂/HCO₃⁻の方向で主病態を決める</span>
        </button>

        <button class="choice big stageBtn" data-stage="3">
          <span class="stageRow">
            <span class="stageTitle"><span class="stageEmoji">🧪</span>ステージ2：代謝性の代償と合併</span>
          </span>
          <span class="sub">HCO₃⁻ + 15 で予測PaCO₂ → 代償と合併を判定</span>
        </button>

        <button class="choice big stageBtn" data-stage="4">
          <span class="stageRow">
            <span class="stageTitle"><span class="stageEmoji">🧭</span>ステージ3：AG計算と補正</span>
          </span>
          <span class="sub">AG / 補正AG / 補正HCO₃で混合を見抜く</span>
        </button>

        <button class="choice big stageBtn" data-stage="5">
          <span class="stageRow">
            <span class="stageTitle"><span class="stageEmoji">⚗️</span>ステージ4：呼吸性異常の急性/慢性</span>
          </span>
          <span class="sub">HCO₃⁻の動きで代謝性代償の有無を判定</span>
        </button>

        <button class="choice big stageBtn" data-stage="6">
          <span class="stageRow">
            <span class="stageTitle"><span class="stageEmoji">🫁</span>ステージ5：原因検索の優先順位</span>
          </span>
          <span class="sub">病態ごとに次の一手（検査・鑑別）を選ぶ</span>
        </button>

        <button class="choice big stageBtn" data-stage="7">
          <span class="stageRow">
            <span class="stageTitle"><span class="stageEmoji">🧩</span>ステージ6：症例ベース総合問題</span>
          </span>
          <span class="sub">血ガス → 異常選択 → 追加検査 → 病態推論</span>
        </button>
      </div>

      <div class="actions">
        <button id="toLessonBtn" class="btn" disabled>解説へ</button>
      </div>
    </section>

    <!-- LESSON -->
    <section class="card screen hidden" id="screenLesson">
      <h2 id="lessonTitle">解説</h2>
      <div id="lessonBody" class="lesson"></div>

      <div class="actions">
        <button id="toGameBtn" class="btn">血ガスゲームへ</button>
        <button id="backToMenuBtn" class="btn ghost">戻る</button>
      </div>
    </section>

    <!-- GAME -->
    <section class="card screen hidden" id="screenGame">
      <div class="hud">
        <div class="hudBox">
          <div class="hudRow">
            <div id="hudStat" class="hudValue">-</div>
            <div id="hudSub" class="hudNeed">-</div>
          </div>
        </div>
        <button id="toggleNormBtn" class="hudBtn" type="button">正常値</button>
      </div>

      <div id="normPanel" class="normPanel hidden">
        <div><b>pH</b> 7.35–7.45</div>
        <div><b>PaCO₂</b> 35–45 mmHg</div>
        <div><b>PaO₂</b> 80–100 mmHg</div>
        <div><b>HCO₃⁻</b> 22–26 mEq/L</div>
        <div><b>Na</b> 135–145 mEq/L</div>
        <div><b>K</b> 3.5–5.0 mEq/L</div>
        <div><b>Cl</b> 98–106 mEq/L</div>
        <div><b>Alb</b> 3.5–5.0 g/dL</div>
        <div><b>AG</b> 8–12 mEq/L</div>
      </div>

      <div class="healthRow">
        <div class="healthBar" aria-label="体力ゲージ">
          <div id="healthFill" class="healthFill"></div>
        </div>
      </div>

      <div class="lane">
        <div class="goalLine"></div>
      </div>

      <div id="judgeFx" class="judgeFx hidden" aria-hidden="true">○</div>

      <div id="startOverlay" class="startOverlay">
        <div class="startBox">
          <h2 class="startTitle" id="startTitle">血ガスゲーム</h2>
          <p class="muted" id="startDesc">スタートして開始</p>
          <button id="startBtn" class="btn">スタート</button>
        </div>
      </div>

      <div class="panel">
        <div id="hintArea" class="hintArea hidden">
          <div class="hintTitle">ヒント（最初の10問）</div>
          <ul id="hintList" class="hintList"></ul>
        </div>

        <div class="choices" id="choices"></div>

        <!-- Stage2用（使わないが残してもOK） -->
        <div class="choices hidden" id="compChoices">
          <button class="choiceBtn" id="compOkBtn">代償OK</button>
          <button class="choiceBtn" id="compNgBtn">代償NG</button>
        </div>

        <div class="confirmRow">
          <button id="pauseBtn" class="btn ghost">一時停止</button>
          <button id="restartBtn" class="btn ghost">やり直し</button>
          <button id="exitBtn" class="btn ghost">メニューへ</button>
        </div>

        <div class="feedback" id="feedback"></div>
      </div>
    </section>

    <!-- RESULT -->
    <div id="resultModal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modalBackdrop"></div>
      <div class="modalCard">
        <div class="modalTop">
          <div id="rankTitle" class="rankTitle">結果</div>
        </div>

        <div class="modalBody">
          <div class="scoreBig"><span id="scoreNum">0</span></div>
          <div class="scoreSub">
            正答率：<span id="scoreRate">0</span>%　
            ミス：<span id="missNum">0</span>
          </div>
          <div id="unlockMsg" class="unlockMsg"></div>
          <div class="muted">ログはこの端末のブラウザに保存されます。</div>
        </div>

        <div class="modalBtns">
          <button id="retryBtn" class="btn">もう一回</button>
          <button id="nextBtn" class="btn" disabled>次ステージへ</button>
          <button id="downloadLogBtn" class="btn ghost">ログCSV</button>
          <button id="menuBtn" class="btn ghost">メニューへ</button>
        </div>
      </div>
    </div>

    <div id="wrongModal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modalBackdrop"></div>
      <div class="modalCard">
        <div class="modalTop">
          <div class="rankTitle">不正解</div>
        </div>
        <div class="modalBody">
          <div class="wrongAnswerLabel">正解</div>
          <div id="wrongAnswer" class="wrongAnswer">-</div>
          <div class="wrongAnswerLabel">解説</div>
          <div id="wrongExplain" class="wrongExplain">-</div>
        </div>
        <div class="modalBtns">
          <button id="wrongCloseBtn" class="btn">閉じる</button>
        </div>
      </div>
    </div>

    <footer class="foot"><small>血液ガスゲーム</small></footer>
  </main>

  <!-- Audio -->
  <audio id="bgmEarly" src="assets/MusMus-BGM-172.mp3" preload="auto" loop></audio>
  <audio id="bgmLate"  src="assets/MusMus-BGM-171.mp3" preload="auto" loop></audio>

  <audio id="seOk"       src="assets/seikai.mp3" preload="auto"></audio>
  <audio id="seBad"      src="assets/huseikai.mp3" preload="auto"></audio>
  <audio id="seFinish"   src="assets/finish.mp3" preload="auto"></audio>
  <audio id="seGameover" src="assets/gameover.mp3" preload="auto"></audio>
  <audio id="seUnlock"   src="assets/maou_game_jingle09.mp3" preload="auto"></audio>
  <audio id="seClick"    src="assets/maou_se_system49.mp3" preload="auto"></audio>

  <!-- ★希望通り：app.js を moduleで -->
  <script type="module" src="./app.js"></script>
</body>
</html>
